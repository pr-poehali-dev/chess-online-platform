import { useState, useEffect, useRef } from "react";
import Icon from "@/components/ui/icon";

const RULES_TEXT = `1. Правила шахмат В шахматы играют на квадратной доске, состоящей из восьми рядов (называемых горизонталями и обозначаемых числами от 1 до 8) и восьми столбцов (называемых вертикалями и обозначаемых буквами от a до h). Цвета шестидесяти четырех клеток чередуются между светлыми и темными и называются «светлыми клетками» и «темными клетками». Шахматная доска располагается таким образом, чтобы у каждого игрока была белая клетка в правом верхнем углу, а фигуры расставляются, как показано на схеме, причем каждая ферзь находится на клетке соответствующего цвета. Каждый игрок начинает игру с шестнадцатью фигурами: у каждого игрока один король, одна ферзь, две ладьи, два слона, два коня и восемь пешек. Один игрок, называемый Белыми, управляет белыми фигурами, а другой игрок, Черный, — черными; Белые всегда ходят первыми. Цвета выбираются либо по дружеской договоренности, либо в результате случайной игры, либо по решению организатора турнира. Игроки по очереди ходят по одной фигуре за раз (за исключением рокировки, когда ходят две фигуры одновременно). Фигуры перемещаются либо на свободное поле, либо на поле, занятое фигурой противника, захватывая ее и удаляя из игры. За одним исключением (на проходе), все фигуры захватывают фигуры противника, перемещаясь на поле, которое занимает фигура противника. 1.1. Король Когда король находится под прямой атакой одной (или, возможно, двумя) фигурами противника, игрок находится под шахом. В состоянии шах разрешаются только ходы, выводящие короля из-под атаки. Игрок не должен делать ходов, которые могли бы поставить его короля под шах. Цель игры — поставить мат противнику; это происходит, когда король противника находится под шахом, и нет ходов, выводящих короля из-под атаки. Король может перемещаться только на одну клетку по горизонтали, вертикали или диагонали. В начале игры каждому королю разрешается совершить специальный двойной ход — рокировку. Рокировка заключается в перемещении короля на две клетки в сторону ладьи, а затем перемещении ладьи на клетку, через которую пересек король. Рокировка допустима только при выполнении всех следующих условий: Игрок ни в коем случае не должен был перемещать одновременно и короля, и ладью, участвующие в рокировке. Между королем и ладьей не должно быть фигур. Король не может находиться под шахом в данный момент, а также не может проходить через поля, атакуемые вражескими фигурами. Как и любой ход, рокировка недопустима, если она приведет к шаху на короле. Король и ладья должны быть на одной горизонтали (чтобы исключить рокировку превращенной пешкой). 1.2. Ладья Ладья перемещается на любое количество свободных полей по вертикали или горизонтали (она также участвует в особом ходе короля — рокировке). 1.3. Епископ Слон перемещается на любое количество свободных полей по диагонали в любом направлении. Обратите внимание, что цвет поля у слона никогда не меняется, поэтому игроки говорят о «светло-полочных» или «темно-полочных» слонах. 1.4. Королева Ферзь может перемещаться на любое количество свободных клеток по диагонали, горизонтали или вертикали. 1.5. Рыцарь Конь может перепрыгивать через занятые клетки и перемещаться на две клетки по горизонтали и на одну клетку по вертикали или наоборот, образуя фигуру в форме буквы «L». Конь в центре доски имеет восемь клеток, на которые он может перемещаться. Обратите внимание, что каждый раз, когда конь перемещается, цвет его клетки меняется. 1.6. Пешки Пешки имеют самые сложные правила передвижения: пешка может продвинуться на одну клетку вперед, если эта клетка свободна. Если она еще не двигалась, пешка может продвинуться на две клетки вперед, если обе клетки перед ней свободны. Пешка не может двигаться назад. Когда происходит такое первоначальное продвижение на две клетки, в результате которого пешка оказывается горизонтально рядом с пешкой противника, пешка противника может взять эту пешку «на проходе», как если бы она продвинулась всего на одну клетку вперед, а не на две, но только на следующем ходу. Пешки — единственные фигуры, которые берут фигуры иначе, чем двигаются. Они могут взять фигуру противника на любой из двух клеток, прилегающих к клетке перед ними (т.е. на двух клетках по диагонали перед ними), но не могут переместиться на эти клетки, если они свободны. Если пешка продвигается до восьмой горизонтали, она превращается в ферзя, ладью, слона или коня того же цвета. На практике пешка почти всегда превращается в ферзя. 1.7. Остальные правила перемещения За исключением коня, фигуры не могут перепрыгивать друг через друга. Собственные фигуры («дружественные фигуры») не могут быть проходными, если они находятся на линии движения, и дружественная фигура никогда не может заменить другую дружественную фигуру. Вражеские фигуры не могут быть проходными, но могут быть «захвачены». Когда фигура захвачена (или взята), атакующая фигура занимает место вражеской фигуры на своем поле (единственное исключение – проход). Захваченная фигура таким образом удаляется из игры и не может быть возвращена в игру до конца партии. Короля нельзя захватить, только поставить под шах. Если игроку не удается снять шах с короля, наступает мат, и игра заканчивается поражением. Шахматные партии не обязательно должны заканчиваться матом — любой из игроков может сдаться, если ситуация кажется безнадежной. Партии также могут заканчиваться ничьей. Ничья может произойти в нескольких ситуациях, включая ничью по соглашению, пат, тройное повторение позиции, правило пятидесяти ходов или ничью из-за невозможности поставить мат (обычно из-за недостатка материала для мата). 2. Игры на время В игры можно играть с ограничением по времени, задав время хода при создании новой игры. В играх на время у каждого игрока есть определенное количество времени на принятие решения о том, какие ходы сделать, и оставшееся время уменьшается только тогда, когда наступает его очередь хода. 3. Ничья в игре Игра, которая заканчивается без победы для любого из игроков. Большинство ничьих в играх заключаются по договоренности, основанной на правилах. Другие способы, которыми игра может закончиться ничьей, — это тупик, тройное повторение, правило пятидесяти ходов и недостаток материала. Позиция считается ничьей (или ничейной позицией), если любой из игроков, благодаря правильной игре, в конечном итоге может привести игру к положению, в котором игра должна закончиться ничьей, независимо от ходов другого игрока. 3.1. Тупиковая ситуация Патовая ситуация — это позиция, в которой игрок, чей ход, не имеет допустимых ходов, и его король не находится под шахом. Патовая ситуация приводит к немедленной ничьей. 3.2. Тройное повторение Игра считается ничьей, если одна и та же позиция встречается три раза при одном и том же ходе одного и того же игрока, и при этом каждый игрок имеет один и тот же набор допустимых ходов (последнее включает право взять взятие на проходе и право рокировки). 3.3. Правило пятидесяти ходов Правило пятидесяти ходов гласит, что игра заканчивается ничьей после пятидесяти ходов с каждой стороны без ходов пешкой или взятия. 3.4. Недостаточно материала Эндшпиль — это ситуация, когда все пешки взяты, и у одной стороны остался только король, а у другой — только король, король плюс конь или слон. Позиция ничья, потому что доминирующая сторона не может поставить мат независимо от хода. Мат возможен только в том случае, если ошибки слабой стороны покрываются правилом пятидесяти ходов.`;

const IndexFooter = () => {
  const [showRules, setShowRules] = useState(false);
  const [showSupport, setShowSupport] = useState(false);
  const [copied, setCopied] = useState(false);
  const footerContentRef = useRef<HTMLDivElement>(null);

  const copyEmail = () => {
    navigator.clipboard.writeText("ligachess.ru@mail.ru");
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  useEffect(() => {
    if ((showRules || showSupport) && footerContentRef.current) {
      setTimeout(() => {
        footerContentRef.current?.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }, 50);
    }
  }, [showRules, showSupport]);

  return (
    <footer className="border-t border-slate-200 dark:border-white/10 mt-16 py-8">
      <div className="container mx-auto px-4 text-center text-gray-600 dark:text-gray-400">
        <p>© 2026 Лига Шахмат. Все права защищены.</p>
        <div className="flex justify-center gap-6 mt-4">
          <button
            onClick={() => {
              setShowRules(!showRules);
              setShowSupport(false);
            }}
            className="hover:text-gray-900 dark:hover:text-white transition-colors"
          >
            Правила
          </button>
          <button
            onClick={() => {
              setShowSupport(!showSupport);
              setShowRules(false);
            }}
            className="hover:text-gray-900 dark:hover:text-white transition-colors"
          >
            Поддержка
          </button>
        </div>

        {showRules && (
          <div ref={footerContentRef} className="mt-6 max-w-2xl mx-auto text-left bg-slate-50 dark:bg-slate-800/60 rounded-xl p-5 sm:p-6 border border-slate-200 dark:border-white/10">
            <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-3">
              1. Правила шахмат
            </h3>
            <div className="space-y-3 text-sm leading-relaxed text-gray-600 dark:text-gray-400">
              <p>{RULES_TEXT}</p>
            </div>
          </div>
        )}

        {showSupport && (
          <div ref={footerContentRef} className="mt-6 max-w-md mx-auto">
            <button
              onClick={copyEmail}
              className="inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-slate-50 dark:bg-slate-800/60 border border-slate-200 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-slate-700/60 transition-colors"
            >
              <Icon name="Mail" size={18} className="text-blue-500" />
              <span className="text-slate-900 dark:text-white font-medium">
                ligachess.ru@mail.ru
              </span>
              <Icon
                name={copied ? "Check" : "Copy"}
                size={16}
                className={copied ? "text-green-500" : "text-gray-400"}
              />
            </button>
            {copied && (
              <p className="text-green-500 text-sm mt-2">Скопировано!</p>
            )}
          </div>
        )}
      </div>
    </footer>
  );
};

export default IndexFooter;
